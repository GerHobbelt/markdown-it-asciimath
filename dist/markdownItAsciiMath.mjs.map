{"version":3,"file":"markdownItAsciiMath.mjs","sources":["../index.js"],"sourcesContent":["\nlet katex = require('katex');\nlet assign = require('lodash.assign');\nlet defaults = {\n  useKeyword: false\n};\nlet options;\n\nfunction setup(md, o) {\n  // use defaults if no options set\n  options = o;\n  if (typeof options.useKeyword === 'undefined') {\n    options.useKeyword = defaults.useKeyword;\n  }\n\n  let useKeyword = options.useKeyword;\n  let defaultRender = md.renderer.rules.fence;\n\n  md.renderer.rules.fence = function (tokens, idx, options, env, self) {\n    let token = tokens[idx];\n\n    if (token.info === 'math') {\n      return render(token.content, true);\n    }\n\n    if (token.info === 'latex') {\n      return renderTeX(token.content, true);\n    }\n\n    // pass token to default renderer.\n    return defaultRender(tokens, idx, options, env, self);\n  };\n\n  md.renderer.rules.code_inline = function (tokens, idx, options, env, self) {\n    let token = tokens[idx];\n\n    if (!useKeyword) {\n      return renderInline(token.content.trim(), false);\n    }\n    if (token.content.substr(0, 4) === 'math') {\n      return renderInline(token.content.substr(4).trim(), false);\n    } else if (token.content.substr(0, 5) === 'latex') {\n      return renderElement(token.content.substr(5).trim(), false);\n    }\n\n\n    return defaultRender(tokens, idx, options, env, self);\n  };\n}\n\nfunction render(str, disp) {\n  // split content\n  let arr = str.trim().split('\\n\\n');\n  let result = '';\n\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i]) {\n      result += '<p>' + renderElement(preprocessMath(arr[i]), disp) + '<p>';\n    }\n  }\n\n  return result;\n}\n\nfunction renderTeX(str, disp) {\n  // split content\n  let arr = str.trim().split('\\n');\n  let result = '';\n\n  // render each line, skipping empty lines\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i]) {\n      result += '<p>' + renderElement(arr[i], disp) + '<p>';\n    }\n  }\n\n  return result;\n}\n\nfunction renderInline(str, disp) {\n  return renderElement(preprocessMath(str), disp);\n}\n\nfunction renderElement(str, disp) {\n  return katex.renderToString(str, { displayMode: disp });\n}\n\nfunction preprocessMath(str) {\n  // parse to TeX\n  let newstr = AMTparseAMtoTeX(str);\n\n  return newstr;\n}\n\nmodule.exports = setup;\n"],"names":["katex","require","assign","defaults","useKeyword","options","setup","md","o","defaultRender","renderer","rules","fence","tokens","idx","env","self","token","info","render","content","renderTeX","code_inline","renderInline","trim","substr","renderElement","str","disp","arr","split","result","i","length","preprocessMath","renderToString","displayMode","newstr","AMTparseAMtoTeX","module","exports"],"mappings":"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"}